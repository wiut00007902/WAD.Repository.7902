@{ ViewData["Title"] = "Home Page"; }

<div ng-app="ManagementApplicationSPA">
    <div ng-view>

    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js" type="text/javascript"></script>

<script type="text/javascript">
 
</script>

<script type="text/javascript">
    angular
        .module('ManagementApplicationSPA', ['ngRoute'])
        .config(function ($routeProvider) {
            $routeProvider
                .when('/',
                    {
                        templateUrl: 'pages/home/index.html',
                        controller: 'IndexController'
                    })
                .when('/regions',
                    {
                        templateUrl: 'pages/regions/index.html',
                        controller: 'ReionsController'
                    })
                .when('/departments',
                    {
                        templateUrl: 'pages/departments/index.html',
                        controller: 'DepartmentsController'
                    })
                .when('/employees',
                    {
                        templateUrl: 'pages/employees/index.html',
                        controller: 'EmployeesController'
                    })
                .when('/tasks',
                    {
                        templateUrl: 'pages/tasks/index.html',
                        controller: 'TasksController'
                    })
                .when('/createRegion',
                    {
                        templateUrl: 'pages/regions/create.html',
                        controller: 'CreateReionController'
                    })
                .when('/createDepartment',
                    {
                        templateUrl: 'pages/departments/create.html',
                        controller: 'CreateDepartmentController'
                    })
                .when('/createEmployee',
                    {
                        templateUrl: 'pages/employees/create.html',
                        controller: 'CreateEmployeeController'
                    })
                .when('/createTask',
                    {
                        templateUrl: 'pages/tasks/create.html',
                        controller: 'CreateTaskController'
                    })
                .when('/editRegion/:regionId',
                    {
                        templateUrl: 'pages/regions/edit.html',
                        controller: 'EditReionController'
                    })
                .when('/editDepartment/:departmentId',
                    {
                        templateUrl: 'pages/departments/edit.html',
                        controller: 'EditDepartmentController'
                    })
                .otherwise({
                    redirectTo: '/'
                });
        })
        .controller('IndexController', ['$scope', '$http', function ($scope, $http) {
            $scope.message = 'Welcome text';
        }])
        .controller('ReionsController', ['$scope', '$http', function ($scope, $http) {
            $scope.regions = [];
            $http.get('@Url.Action("GetRegions", "Regions")')
                .then(function (response) {
                    $scope.regions = response.data;
                })
        }])
        .controller('DepartmentsController', ['$scope', '$http', function ($scope, $http) {
            $scope.departments = [];
            $http.get('@Url.Action("GetDepartments", "Departments")')
                .then(function (response) {
                    $scope.departments = response.data;
                })
        }])
        .controller('EmployeesController', ['$scope', '$http', function ($scope, $http) {
            $scope.employees = [];
            $http.get('@Url.Action("GetEmployees", "Employees")')
                .then(function (response) {
                    $scope.employees = response.data;
                })
        }])
        .controller('TasksController', ['$scope', '$http', function ($scope, $http) {
            $scope.tasks = [];
            $http.get('@Url.Action("GetTasks", "Tasks")')
                .then(function (response) {
                    $scope.tasks = response.data;
                })
        }])
        .controller('CreateReionController', ['$scope', '$http', '$location', function ($scope, $http, $location) {
            $scope.region =
            {
                id: 0,
                regionName: '',
            };

            $scope.addRegion = function () {
                $http.post('@Url.Action("PostRegion", "Regions")', $scope.region)
                    .then(function (response) {
                        $location.path('/regions');
                    });
            };
        }])
        .controller('CreateDepartmentController', ['$scope', '$http', '$location', function ($scope, $http, $location) {
            $scope.department =
            {
                departmentName: '',
                regionId: 0,
            };

            $scope.departmentRegion =
            {
                region: {}
            };

            $scope.regions = [];
            $http.get('@Url.Action("GetRegions", "Regions")')
                .then(function (response) {
                    $scope.regions = response.data;
                })

            $scope.addDepartment = function () {

                $scope.department.regionId = $scope.departmentRegion.region.id;

                $http.post('@Url.Action("PostDepartment", "Departments")', $scope.department)
                    .then(function (response) {
                        $location.path('/departments');
                    });
            };
        }])
        .controller('CreateEmployeeController', ['$scope', '$http', '$location', function ($scope, $http, $location) {
            $scope.employee =
            {
                firstName: '',
                lastName: '',
                dateOfBirth: '',
                gender: 0,
                passportNo: '',
                address: '',
                phone: '',
                email: '',
                departmentId: '',
                position: '',
                salary: 0,
                schedule: 0
            };

            $scope.employeeDepartments =
            {
                department: {}
            };

            $scope.departments = [];
            $http.get('@Url.Action("GetDepartments", "Departments")')
                .then(function (response) {
                    $scope.departments = response.data;
                })

            $scope.addEmployee = function () {

                $scope.employee.departmentId = $scope.employeeDepartments.department.id;

                $scope.employee.gender = $scope.employee.gender - 0;
                $scope.employee.schedule = $scope.employee.schedule - 0;

                $http.post('@Url.Action("PostEmployee", "Employees")', $scope.employee)
                    .then(function (response) {
                        $location.path('/employees');
                    });
            };
        }])
        .controller('CreateTaskController', ['$scope', '$http', '$location', function ($scope, $http, $location) {
            $scope.task =
            {
                taskName: '',
                taskDescription: '',
                employeeId: '',
                deadline: ''
            };

            $scope.taskEmployee =
            {
                employee: {}
            };

            $scope.employees = [];
            $http.get('@Url.Action("GetEmployees", "Employees")')
                .then(function (response) {
                    $scope.employees = response.data;
                })

            $scope.addTask = function () {

                $scope.task.employeeId = $scope.taskEmployee.employee.id;

                $http.post('@Url.Action("PostTask", "Tasks")', $scope.task)
                    .then(function (response) {
                        $location.path('/tasks');
                    });
            };
        }])
        .controller('EditReionController', ['$scope', '$http', '$location', '$routeParams', function ($scope, $http, $location, $routeParams) {
            $scope.region =
            {
                id: 0,
                regionName: '',
            };

            $http.get('@Url.Action("GetRegions", "Regions")/' + $routeParams.regionId)
                .then(function (response) {
                    $scope.region = response.data;
                });

            $scope.editRegion = function () {
                $http.put('@Url.Action("GetRegions", "Regions")/' + $routeParams.regionId, $scope.region)
                    .then(function (response) {
                        $location.path('/regions');
                    });
            };
        }])
        .controller('EditDepartmentController', ['$scope', '$http', '$location', '$routeParams', function ($scope, $http, $location, $routeParams) {
            $scope.department =
            {
                departmentName: '',
                regionId: 0,
            };

            $scope.departmentRegion =
            {
                region: {}
            };

            $scope.regions = [];
            $http.get('@Url.Action("GetRegions", "Regions")')
                .then(function (response) {
                    $scope.regions = response.data;
                })

            $http.get('@Url.Action("GetDepartments", "Departments")/' + $routeParams.departmentId)
                .then(function (response) {
                    $scope.department = response.data;
                });

            $scope.editDepartment = function () {

                $scope.department.regionId = $scope.departmentRegion.region.id;

                $http.put('@Url.Action("GetDepartments", "Departments")/' + $routeParams.departmentId, $scope.department)
                    .then(function (response) {
                        $location.path('/departments');
                    });
            };
        }]);
</script>